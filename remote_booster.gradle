

ext.booster_version = '4.2.1'

def isRelease(){
    for (String s : gradle.startParameter.taskNames) {
        if (s.contains("ultiChannel") | s.contains("elease")) {
            return true
        }
    }
    return false
}

rootProject.buildscript {
    repositories {
        google()
        jcenter()
        mavenCentral()
        maven { url 'https://jitpack.io' }
        maven { url 'https://oss.sonatype.org/content/repositories/public/' }
        maven { url 'https://oss.sonatype.org/content/repositories/snapshots/' }
    }
    dependencies {
        classpath "com.didiglobal.booster:booster-gradle-plugin:$booster_version" // â‘ 
        // â‘¡ figure out the features you really need, then choose the right module for integration
        // â‘¡ å¼„æ¸…æ¥šçœŸæ­£éœ€è¦çš„ç‰¹æ€§ï¼Œç„¶åä»ä¸‹é¢çš„æ¨¡å—åˆ—è¡¨ä¸­é€‰æ‹©æ­£ç¡®çš„æ¨¡å—è¿›è¡Œé›†æˆ
        if(isRelease()){
            classpath "com.didiglobal.booster:booster-task-analyser:$booster_version"
            println("booster-task-analyser  --> é€šè¿‡é»‘/ç™½åå•çš„æ–¹å¼å¯¹ APP è¿›è¡Œæ‰«æï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„åˆ†ææŠ¥å‘Šï¼Œä½¿å¾—å¼€å‘è€…å¯¹ APP çš„è´¨é‡æœ‰ä¸€ä¸ªæ›´å…¨é¢å’Œæ·±å…¥çš„äº†è§£ï¼Œå¹¶ä¸ºæ›´æ·±å±‚æ¬¡çš„ä¼˜åŒ–æä¾›æ€è·¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š\n" +
                    "\n" +
                    "å‘ç°æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ï¼Œå¦‚ï¼šå¯èƒ½é˜»å¡ä¸»çº¿ç¨‹/ UI çº¿ç¨‹çš„ API è°ƒç”¨ï¼›\n" +
                    "å‘ç°é£é™© API è°ƒç”¨ï¼›\n" +
                    "åˆ†æä¾èµ–å…³ç³»ï¼›")
            //
            /* ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡å›¾ç‰‡å‹ç¼© å¼•ç”¨è¿™ä¸‰ä¸ªæ¨¡å— ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ */
            //æŠ¥å‘Šåœ°å€: build/reports/booster-task-compression-cwebp/${variant}/report.txt
            classpath "com.didiglobal.booster:booster-task-compression-cwebp:$booster_version"
            classpath "com.didiglobal.booster:booster-task-compression-pngquant:$booster_version"
            classpath "io.johnsonlee.booster:booster-pngquant-provider:2.3.0"

            /* å¼€å¯ ZIP å‹ç¼© å¼•ç”¨è¿™ä¸ªæ¨¡å—   å‹ç¼©ç‡ä¸é«˜,0.07%çš„çº§åˆ«. å»é™¤*/
           // classpath "com.didiglobal.booster:booster-task-compression-processed-res:$booster_version"
            /* å¼€å¯ç³»ç»Ÿå´©æºƒå…œåº• */
            classpath "com.didiglobal.booster:booster-transform-activity-thread:$booster_version"
            //Finalizer å¯¼è‡´çš„ TimeoutException
            classpath "com.didiglobal.booster:booster-transform-finalizer-watchdog-daemon:$booster_version"
            //èµ„æºä¸º null çš„é—®é¢˜
            classpath "com.didiglobal.booster:booster-transform-res-check:$booster_version"
            //Android 7.1 Toast å´©æºƒ
            //classpath "com.didiglobal.booster:booster-transform-toast:$booster_version"
            //é¿å…ä¾èµ– SNAPSHOT ç‰ˆæœ¬
            classpath "com.didiglobal.booster:booster-task-check-snapshot:$booster_version"
            //åˆ—å‡ºå·¥ç¨‹ä¸­ä¾èµ–çš„ AAR ä¸­ä½¿ç”¨çš„æ‰€æœ‰çš„åŠ¨æ€åº“
            classpath "com.didiglobal.booster:booster-task-list-shared-library:$booster_version"
            //åˆ—å‡ºæ„å»ºçš„ä¸­é—´äº§ç‰©
            classpath "com.didiglobal.booster:booster-task-list-artifact:$booster_version"
        }
    }
}

def hasApplyBooster(Project project0){
    return project0.plugins.findPlugin("com.didiglobal.booster") != null
}



gradle.addProjectEvaluationListener(new ProjectEvaluationListener() {
    @Override
    void beforeEvaluate(Project project) {
    }

    @Override
    void afterEvaluate(Project project, ProjectState projectState) {
        if(!isRelease()){
            return
        }
        if(project.plugins.findPlugin("com.android.application") == null){
            return
        }

        if(hasApplyBooster(project)){
            println("å·²ç»åº”ç”¨äº†boosteræ’ä»¶,å°†æœ‰å¦‚ä¸‹åŠŸèƒ½å¼€å¯:")
        }else {
            println("åº”ç”¨boosteræ’ä»¶,å¹¶å¼€å¯å¦‚ä¸‹åŠŸèƒ½:")
            project.apply plugin: 'com.didiglobal.booster'
        }
    }
})



